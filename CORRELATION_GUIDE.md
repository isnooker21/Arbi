# ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏´‡∏≤ Correlation ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Arbi Trading
# Correlation Calculation Guide

## üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°: ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏≤ Correlation ‡πÅ‡∏ö‡∏ö Multi-Layer

‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏´‡∏≤ Correlation ‡πÅ‡∏ö‡∏ö **‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô (Multi-Layer)** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô:

```
Layer 1: Real-time Calculation ‡∏à‡∏≤‡∏Å Historical Data ‚úÖ (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
   ‚Üì ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
Layer 2: Alternative Calculation ‡∏à‡∏≤‡∏Å Tick Data üìä
   ‚Üì ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
Layer 3: Dynamic Correlation ‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô üßÆ
   ‚Üì ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
Layer 4: Default Correlations (Fallback) üìã
```

---

## üéØ Layer 1: Real-time Calculation (‡∏à‡∏≤‡∏Å Historical Data)

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

```python
# ‡πÑ‡∏ü‡∏•‡πå: trading/adaptive_engine.py
# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô: _calculate_on_demand_correlations()
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:

#### 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á (Historical Data)
```
- ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 30 ‡∏ß‡∏±‡∏ô (30 * 24 = 720 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)
- ‡πÉ‡∏ä‡πâ Timeframe: H1 (1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)
- ‡∏à‡∏≤‡∏Å MT5 ‡∏ú‡πà‡∏≤‡∏ô broker.get_historical_data()

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
EURUSD: [1.1000, 1.1010, 1.1005, 1.0995, ...]  (720 ‡∏à‡∏∏‡∏î)
GBPUSD: [1.2500, 1.2510, 1.2505, 1.2495, ...]  (720 ‡∏à‡∏∏‡∏î)
```

#### 2. ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° Timestamp
```python
# Align data ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ pandas merge
merged = pd.merge(
    base_data[['close']],      # EURUSD
    pair_data[['close']],       # GBPUSD
    left_index=True,            # ‡πÉ‡∏ä‡πâ timestamp
    right_index=True,
    suffixes=('_base', '_pair')
)

# ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
# timestamp          | close_base | close_pair
# 2025-10-01 00:00  | 1.1000     | 1.2500
# 2025-10-01 01:00  | 1.1010     | 1.2510
# ...
```

#### 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Returns (‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô)
```python
# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì % ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
returns_base = merged['close_base'].pct_change().dropna()
returns_pair = merged['close_pair'].pct_change().dropna()

# ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
# EURUSD returns: [0.0009, -0.0005, -0.0009, ...]  (% change)
# GBPUSD returns: [0.0008, -0.0004, -0.0008, ...]  (% change)
```

#### 4. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Correlation
```python
# ‡πÉ‡∏ä‡πâ Pearson Correlation Coefficient
correlation = returns_base.corr(returns_pair)

# ‡∏™‡∏π‡∏ï‡∏£:
# œÅ = Cov(X,Y) / (œÉ_X √ó œÉ_Y)
# 
# ‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà:
# - Cov(X,Y) = Covariance ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á X ‡πÅ‡∏•‡∏∞ Y
# - œÉ_X = Standard Deviation ‡∏Ç‡∏≠‡∏á X
# - œÉ_Y = Standard Deviation ‡∏Ç‡∏≠‡∏á Y
```

### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
```
EURUSD vs GBPUSD = 0.85  (Positive correlation ‡∏™‡∏π‡∏á)
EURUSD vs USDCHF = -0.82 (Negative correlation ‡∏™‡∏π‡∏á)
EURUSD vs USDJPY = -0.70 (Negative correlation ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á)
```

### ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
```python
def calculate_correlation(self, symbol1, symbol2, lookback_days=30):
    """
    ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì correlation ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• MT5
    """
    # 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤
    data1 = self.broker.get_historical_data(symbol1, 'H1', lookback_days * 24)
    data2 = self.broker.get_historical_data(symbol2, 'H1', lookback_days * 24)
    
    # 2. Merge data
    merged = pd.merge(data1[['close']], data2[['close']], 
                     left_index=True, right_index=True)
    
    # 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì returns
    returns1 = merged['close_x'].pct_change().dropna()
    returns2 = merged['close_y'].pct_change().dropna()
    
    # 4. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì correlation
    correlation = returns1.corr(returns2)
    
    return correlation  # ‡∏Ñ‡πà‡∏≤ -1.0 ‡∏ñ‡∏∂‡∏á +1.0
```

### ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏ú‡∏•:
```
Correlation Value    | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢
--------------------|--------------------
+0.9 ‡∏ñ‡∏∂‡∏á +1.0       | ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡πÜ
+0.7 ‡∏ñ‡∏∂‡∏á +0.9       | ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
+0.3 ‡∏ñ‡∏∂‡∏á +0.7       | ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ö‡πâ‡∏≤‡∏á
-0.3 ‡∏ñ‡∏∂‡∏á +0.3       | ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
-0.7 ‡∏ñ‡∏∂‡∏á -0.3       | ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ö‡πâ‡∏≤‡∏á
-0.9 ‡∏ñ‡∏∂‡∏á -0.7       | ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°
-1.0 ‡∏ñ‡∏∂‡∏á -0.9       | ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏°‡∏≤‡∏Å‡πÜ
```

---

## üìä Layer 2: Alternative Calculation (‡∏à‡∏≤‡∏Å Tick Data)

### ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡πÉ‡∏ä‡πâ?
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Historical Data ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Layer 1 ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:

```python
# ‡πÑ‡∏ü‡∏•‡πå: trading/adaptive_engine.py
# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô: _calculate_correlations_alternative()
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:

#### 1. ‡∏î‡∏∂‡∏á Tick Data ‡πÅ‡∏ó‡∏ô Historical Data
```python
# ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Tick ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô
tick_data = self.broker.get_tick_data()

# ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á tick_data:
{
    'EURUSD': {'bid': 1.1000, 'ask': 1.1002, 'timestamp': ...},
    'GBPUSD': {'bid': 1.2500, 'ask': 1.2502, 'timestamp': ...},
    ...
}
```

#### 2. ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Tick ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
```
‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡πÄ‡∏Å‡πá‡∏ö Tick ‡∏ó‡∏∏‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
= 60 ‡∏à‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

EURUSD: [1.1000, 1.1001, 1.0999, ...]
GBPUSD: [1.2500, 1.2501, 1.2499, ...]
```

#### 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Correlation ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Layer 1
```python
# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì returns ‡πÅ‡∏•‡∏∞ correlation
returns1 = np.diff(prices1) / prices1[:-1]
returns2 = np.diff(prices2) / prices2[:-1]

correlation = np.corrcoef(returns1, returns2)[0, 1]
```

### ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:
- ‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Real-time)
- ‚úÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ Historical Data

### ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:
- ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ (‡∏°‡∏µ‡πÅ‡∏Ñ‡πà tick ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
- ‚ö†Ô∏è ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÄ‡∏ó‡πà‡∏≤ Historical Data

---

## üßÆ Layer 3: Dynamic Correlation (‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô)

### ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡πÉ‡∏ä‡πâ?
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Historical ‡πÅ‡∏•‡∏∞ Tick Data
- ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Estimation

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:

```python
# ‡πÑ‡∏ü‡∏•‡πå: trading/correlation_manager.py
# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô: _calculate_dynamic_correlation()
```

### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô

```
‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô = ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô 1 + ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô 2

EURUSD = EUR + USD
GBPUSD = GBP + USD
EURGBP = EUR + GBP
```

### ‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:

#### ‡∏Å‡∏é‡∏ó‡∏µ‡πà 1: ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‚Üí Positive Correlation ‡∏™‡∏π‡∏á
```
EURUSD (EUR/USD) vs GBPUSD (GBP/USD)
‚Üí ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏°‡∏µ USD ‚Üí Correlation = 0.75

‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ‡∏ñ‡πâ‡∏≤ USD ‡πÅ‡∏Ç‡πá‡∏á ‚Üí EURUSD ‡∏•‡∏á ‡πÅ‡∏•‡∏∞ GBPUSD ‡∏•‡∏á (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô)
```

#### ‡∏Å‡∏é‡∏ó‡∏µ‡πà 2: ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏° ‚Üí Negative Correlation ‡∏™‡∏π‡∏á
```
EURUSD (EUR/USD) vs USDCHF (USD/CHF)
‚Üí USD ‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏ô‡∏•‡∏∞‡∏î‡πâ‡∏≤‡∏ô ‚Üí Correlation = -0.75

‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ‡∏ñ‡πâ‡∏≤ USD ‡πÅ‡∏Ç‡πá‡∏á ‚Üí EURUSD ‡∏•‡∏á ‡πÅ‡∏ï‡πà USDCHF ‡∏Ç‡∏∂‡πâ‡∏ô (‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°)
```

#### ‡∏Å‡∏é‡∏ó‡∏µ‡πà 3: ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á ‚Üí Correlation ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
```
EURUSD (EUR/USD) vs EURJPY (EUR/JPY)
‚Üí ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏°‡∏µ EUR ‚Üí Correlation = 0.60

GBPUSD (GBP/USD) vs GBPJPY (GBP/JPY)
‚Üí ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏°‡∏µ GBP ‚Üí Correlation = 0.60
```

#### ‡∏Å‡∏é‡∏ó‡∏µ‡πà 4: Major vs Safe Haven ‚Üí Negative Correlation
```
Majors: EUR, GBP, AUD, NZD, CAD
Safe Havens: JPY, CHF, USD

AUDUSD (Major) vs USDJPY (Safe Haven)
‚Üí Correlation = -0.70

‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á ‚Üí Majors ‡∏•‡∏á, Safe Havens ‡∏Ç‡∏∂‡πâ‡∏ô
```

### ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:

```python
def _calculate_dynamic_correlation(self, base_symbol, target_symbol):
    """
    ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì correlation ‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô
    """
    # ‡πÅ‡∏¢‡∏Å‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô
    base_curr1 = base_symbol[:3]    # EUR
    base_curr2 = base_symbol[3:6]   # USD
    
    target_curr1 = target_symbol[:3]  # GBP
    target_curr2 = target_symbol[3:6] # USD
    
    # ‡∏Å‡∏é‡∏ó‡∏µ‡πà 1: ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
    if base_curr1 == target_curr1 or base_curr2 == target_curr2:
        return 0.75  # Positive correlation ‡∏™‡∏π‡∏á
    
    # ‡∏Å‡∏é‡∏ó‡∏µ‡πà 2: ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°
    if base_curr1 == target_curr2 or base_curr2 == target_curr1:
        return -0.75  # Negative correlation ‡∏™‡∏π‡∏á
    
    # ‡∏Å‡∏é‡∏ó‡∏µ‡πà 3: USD pairs
    if 'USD' in [base_curr1, base_curr2] and 'USD' in [target_curr1, target_curr2]:
        return 0.60  # Correlation ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
    
    # ‡∏Å‡∏é‡∏ó‡∏µ‡πà 4: Major vs Safe Haven
    majors = ['EUR', 'GBP', 'AUD', 'NZD', 'CAD']
    safe_havens = ['JPY', 'CHF', 'USD']
    
    if base_curr1 in majors and target_curr1 in safe_havens:
        return -0.70  # Negative correlation
    
    # Default
    return 0.50
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:

```
‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: EURUSD vs GBPUSD ‡∏°‡∏µ correlation ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?

‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:
EURUSD = EUR + USD
GBPUSD = GBP + USD
‚Üí ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏°‡∏µ USD (‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
‚Üí Correlation = 0.75 ‚úÖ
```

```
‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: EURUSD vs USDCHF ‡∏°‡∏µ correlation ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?

‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:
EURUSD = EUR + USD  (USD ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤)
USDCHF = USD + CHF  (USD ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢)
‚Üí USD ‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏ô‡∏•‡∏∞‡∏î‡πâ‡∏≤‡∏ô (‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°)
‚Üí Correlation = -0.75 ‚úÖ
```

```
‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: AUDUSD vs USDJPY ‡∏°‡∏µ correlation ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?

‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:
AUDUSD = AUD (Major) + USD
USDJPY = USD + JPY (Safe Haven)
‚Üí Major vs Safe Haven
‚Üí Correlation = -0.70 ‚úÖ
```

---

## üìã Layer 4: Default Correlations (Fallback)

### ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡πÉ‡∏ä‡πâ?
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏∏‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
- ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ Backup

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:

```python
# ‡πÑ‡∏ü‡∏•‡πå: trading/adaptive_engine.py
# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô: _get_default_correlations()
```

### ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Default Correlations:

```python
default_correlations = {
    'EURUSD': {
        'USDCHF': -0.85,  # Negative correlation ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
        'AUDCAD': -0.75,
        'USDCAD': -0.72,
        'GBPCHF': -0.80,
        'GBPAUD': -0.68,
        'NZDUSD': -0.65,
    },
    'GBPUSD': {
        'USDCHF': -0.80,
        'USDCAD': -0.70,
        'AUDCAD': -0.68,
        'EURAUD': -0.65,
        'NZDCAD': -0.62
    },
    'USDJPY': {
        'EURUSD': -0.75,
        'GBPUSD': -0.70,
        'AUDUSD': -0.65,
        'NZDUSD': -0.60
    },
    # ... (‡πÅ‡∏•‡∏∞‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ)
}
```

### ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:

```python
# ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤ correlation pairs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö EURUSD
correlations = default_correlations['EURUSD']

# ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
# {
#   'USDCHF': -0.85,
#   'AUDCAD': -0.75,
#   ...
# }

# ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° correlation ‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏á‡πÑ‡∏õ‡∏ï‡πà‡∏≥
sorted_pairs = sorted(correlations.items(), 
                     key=lambda x: abs(x[1]), 
                     reverse=True)

# ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
# [('USDCHF', -0.85),  ‚Üê ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏π‡πà‡∏ô‡∏µ‡πâ
#  ('GBPCHF', -0.80),
#  ('AUDCAD', -0.75),
#  ...]
```

---

## üîÑ Flow ‡∏Å‡∏≤‡∏£‡∏´‡∏≤ Correlation ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á

```mermaid
flowchart TD
    Start([‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤ Correlation<br/>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö EURUSD]) --> CheckCache{‡∏°‡∏µ‡πÉ‡∏ô Cache<br/>‡πÑ‡∏´‡∏°?}
    
    CheckCache -->|Yes| ReturnCache[Return ‡∏à‡∏≤‡∏Å Cache]
    CheckCache -->|No| Layer1[Layer 1: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å Historical Data]
    
    Layer1 --> CheckData1{‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•<br/>‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠?}
    CheckData1 -->|Yes| CalcReal[‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Correlation ‡∏à‡∏£‡∏¥‡∏á]
    
    CalcReal --> ValidateReal{Correlation<br/>‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á?}
    ValidateReal -->|Yes| SaveCache1[‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Cache]
    SaveCache1 --> Success1([Return Correlation])
    
    CheckData1 -->|No| Layer2[Layer 2: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å Tick Data]
    ValidateReal -->|No| Layer2
    
    Layer2 --> CheckData2{‡∏°‡∏µ Tick Data<br/>‡πÑ‡∏´‡∏°?}
    CheckData2 -->|Yes| CalcAlt[‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Alternative Correlation]
    
    CalcAlt --> ValidateAlt{Correlation<br/>‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á?}
    ValidateAlt -->|Yes| SaveCache2[‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Cache]
    SaveCache2 --> Success2([Return Correlation])
    
    CheckData2 -->|No| Layer3[Layer 3: Dynamic Calculation]
    ValidateAlt -->|No| Layer3
    
    Layer3 --> CalcDynamic[‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô]
    CalcDynamic --> ValidateDynamic{Correlation<br/>‡∏™‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏°‡∏ú‡∏•?}
    
    ValidateDynamic -->|Yes| SaveCache3[‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Cache]
    SaveCache3 --> Success3([Return Correlation])
    
    ValidateDynamic -->|No| Layer4[Layer 4: Default Correlations]
    Layer4 --> GetDefault[‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ Default]
    GetDefault --> Success4([Return Default Correlation])
```

---

## üìê ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Correlation ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Recovery

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á:

#### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ï‡∏¥‡∏î‡∏•‡∏ö
```
EURUSD: Volume 0.10 lot, Loss = -$50
```

#### 2. ‡∏´‡∏≤ Correlation Pairs
```python
# ‡∏´‡∏≤ correlation ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ
correlations = adaptive_engine.get_correlations('EURUSD')

# ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
{
    'USDCHF': -0.85,   ‚Üê ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏µ‡πâ (Negative correlation ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)
    'GBPCHF': -0.80,
    'AUDCAD': -0.75,
    'GBPUSD': +0.75,   ‚Üê Positive correlation (‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
    'USDJPY': -0.70,
    ...
}
```

#### 3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Top Candidates
```
‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:
‚úì Correlation >= 0.70 (‡∏™‡∏π‡∏á‡∏û‡∏≠)
‚úì ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö Active Groups
‚úì Spread ‡πÑ‡∏°‡πà‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ

Top 3:
1. USDCHF: -0.85 ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è
2. GBPCHF: -0.80 ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è
3. AUDCAD: -0.75 ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è
```

#### 4. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Hedge Ratio
```python
# Correlation = -0.85 (Negative)
hedge_ratio = abs(correlation) * 1.2
hedge_ratio = 0.85 * 1.2 = 1.02

# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Recovery Volume
recovery_volume = original_volume * hedge_ratio
recovery_volume = 0.10 * 1.02 = 0.102 lot
```

#### 5. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Direction
```
Correlation = -0.85 (Negative)
‚Üí ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°

EURUSD: BUY (‡∏ï‡∏¥‡∏î‡∏•‡∏ö)
‚Üí USDCHF: BUY (‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)

‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:
- EURUSD ‡∏Ç‡∏∂‡πâ‡∏ô (‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡∏±‡∏ß) ‚Üí USDCHF ‡∏•‡∏á
- USDCHF BUY ‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡πÑ‡∏£ ‚Üí ‡∏ä‡∏î‡πÄ‡∏ä‡∏¢ EURUSD ‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö
```

#### 6. Execute Recovery Order
```python
order = {
    'symbol': 'USDCHF',
    'type': 'BUY',
    'volume': 0.102,
    'comment': 'RECOVERY_EURUSD_G1',
    'magic': 234001
}
```

---

## üéØ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á

### ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå: EURUSD ‡∏ï‡∏¥‡∏î‡∏•‡∏ö

```
‡πÄ‡∏ß‡∏•‡∏≤ 10:00
‚îú‚îÄ EURUSD BUY 0.10 lot @ 1.1000
‚îú‚îÄ PnL: -$50
‚îî‚îÄ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ï‡∏¥‡∏î‡∏•‡∏ö
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏´‡∏≤ Correlation
```python
correlations = get_correlations('EURUSD')

# ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å Layer 1 (Historical Data):
{
    'USDCHF': -0.87,  # ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å 30 ‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
    'GBPUSD': +0.82,
    'USDJPY': -0.73,
    'AUDCAD': -0.76,
    ...
}
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Recovery Pair
```
Ranking:
1. USDCHF: -0.87 (Negative, ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î) ‚úÖ
2. GBPUSD: +0.82 (Positive, ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞) ‚ùå
3. AUDCAD: -0.76 (Negative, ‡∏™‡∏π‡∏á) ‚úÖ
4. USDJPY: -0.73 (Negative, ‡∏™‡∏π‡∏á) ‚úÖ

‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: USDCHF (-0.87)
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Volume ‡πÅ‡∏•‡∏∞ Direction
```python
# Hedge Ratio
hedge_ratio = abs(-0.87) * 1.2 = 1.044

# Recovery Volume
recovery_volume = 0.10 * 1.044 = 0.104 lot

# Direction (Negative Correlation)
original_type = 'BUY'
recovery_type = 'BUY'  # ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ negative)
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: Execute Recovery
```
‡πÄ‡∏ß‡∏•‡∏≤ 10:05
‚îú‚îÄ EURUSD BUY 0.10 @ 1.1000 (PnL: -$50)
‚îî‚îÄ USDCHF BUY 0.104 @ 0.9000 (Recovery)
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5: Monitor Recovery
```
‡πÄ‡∏ß‡∏•‡∏≤ 10:15
‚îú‚îÄ EURUSD: -$45 (‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢)
‚îú‚îÄ USDCHF: +$20 (‡∏Å‡∏≥‡πÑ‡∏£!)
‚îî‚îÄ ‡∏£‡∏ß‡∏°: -$25 (‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å -$50)

‡πÄ‡∏ß‡∏•‡∏≤ 10:30
‚îú‚îÄ EURUSD: -$35
‚îú‚îÄ USDCHF: +$40
‚îî‚îÄ ‡∏£‡∏ß‡∏°: +$5 ‚úÖ (‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å!)
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 6: Close Recovery
```
‡πÄ‡∏ß‡∏•‡∏≤ 10:35
‚îú‚îÄ ‡∏õ‡∏¥‡∏î USDCHF (‡∏Å‡∏≥‡πÑ‡∏£ $40)
‚îú‚îÄ EURUSD: -$30 (‡∏¢‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÅ‡∏ï‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô)
‚îî‚îÄ ‡∏£‡∏ß‡∏°: +$10 (‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!)
```

---

## üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Correlation ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ö‡∏ö

| Layer | ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£ | ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ | ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ |
|-------|---------|-------|---------|------------|
| 1. Historical | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å MT5 | ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î | ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏¢‡∏≠‡∏∞ | ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è |
| 2. Tick Data | ‡πÉ‡∏ä‡πâ Tick ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | Real-time | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡πâ‡∏≠‡∏¢ | ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è |
| 3. Dynamic | ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á | ‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î | Estimation | ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è |
| 4. Default | ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏¢‡∏ï‡∏±‡∏ß | ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£ | ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ | ‚≠êÔ∏è‚≠êÔ∏è |

---

## üí° Tips ‡πÅ‡∏•‡∏∞ Best Practices

### 1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Correlation ‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏û‡∏≠
```
‚úÖ Correlation >= 0.70  (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ)
‚ö†Ô∏è Correlation 0.50-0.70 (‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á)
‚ùå Correlation < 0.50  (‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
```

### 2. ‡∏ä‡∏≠‡∏ö Negative Correlation
```
‚úÖ Negative correlation ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ Positive
‚Üí ‡∏ó‡∏≥‡∏Å‡∏≥‡πÑ‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ (‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°)
```

### 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Spread Cost
```
‡∏ñ‡∏∂‡∏á‡πÅ‡∏°‡πâ correlation ‡∏™‡∏π‡∏á ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤ spread ‡∏™‡∏π‡∏á
‚Üí ‡∏Å‡∏≥‡πÑ‡∏£‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°
```

### 4. ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏π‡πà‡∏ã‡πâ‡∏≥
```
‚ùå ‡∏ñ‡πâ‡∏≤ EURUSD ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Group 1 ‡πÅ‡∏•‡πâ‡∏ß
   ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ EURUSD ‡πÄ‡∏õ‡πá‡∏ô Recovery pair
```

### 5. Monitor Real-time
```
‚úÖ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏à‡∏£‡∏¥‡∏á
‚Üí ‡∏ñ‡πâ‡∏≤ correlation ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö strategy
```

---

## üî¨ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö Correlation

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:
```python
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì correlation
from utils.calculations import TradingCalculations

calc = TradingCalculations()

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö
prices1 = [1.1000, 1.1010, 1.1020, 1.1030, 1.1040]
prices2 = [1.2500, 1.2510, 1.2520, 1.2530, 1.2540]

# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì correlation
correlation = calc.calculate_correlation(prices1, prices2)

print(f"Correlation: {correlation:.4f}")
# ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: Correlation: 1.0000 (‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á)
```

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö Opposite Movement:
```python
prices1 = [1.1000, 1.1010, 1.1020, 1.1030, 1.1040]
prices2 = [0.9000, 0.8990, 0.8980, 0.8970, 0.8960]  # ‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°

correlation = calc.calculate_correlation(prices1, prices2)
print(f"Correlation: {correlation:.4f}")
# ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: Correlation: -1.0000 (‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏™‡∏ô‡∏¥‡∏ó)
```

---

## ‚ùì ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢

### Q1: ‡∏ó‡∏≥‡πÑ‡∏° correlation ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏ö‡πÑ‡∏î‡πâ?
**A:** Negative correlation ‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°:
```
EURUSD ‡∏Ç‡∏∂‡πâ‡∏ô ‚Üí USDCHF ‡∏•‡∏á (correlation = -0.85)
EURUSD ‡∏•‡∏á ‚Üí USDCHF ‡∏Ç‡∏∂‡πâ‡∏ô
```

### Q2: ‡∏Ñ‡πà‡∏≤ correlation ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏´‡∏°?
**A:** ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô! ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡∏ï‡∏•‡∏≤‡∏î:
```
‡∏™‡∏†‡∏≤‡∏û‡∏ï‡∏•‡∏≤‡∏î‡∏õ‡∏Å‡∏ï‡∏¥:     EURUSD vs GBPUSD = 0.85
‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô:       EURUSD vs GBPUSD = 0.65
‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
```

### Q3: ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ returns ‡πÅ‡∏ó‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤?
**A:** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÑ‡∏î‡πâ:
```
EURUSD: 1.1000 ‚Üí 1.1010 = +0.09% returns
GBPUSD: 1.2500 ‚Üí 1.2512 = +0.096% returns
‚Üí ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô (correlation ‡∏™‡∏π‡∏á)

‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏£‡∏á:
1.1010 vs 1.2512 ‚Üí ‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå)
```

### Q4: Layer ‡πÑ‡∏´‡∏ô‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?
**A:** Layer 1 (Historical Data) ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:
```
Layer 1 > Layer 2 > Layer 3 > Layer 4
‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö
```

### Q5: ‡∏ï‡πâ‡∏≠‡∏á recalculate correlation ‡∏ö‡πà‡∏≠‡∏¢‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô?
**A:** ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:
```
- On-demand: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ
- Cache: ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô memory
- Refresh: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î Recovery position ‡πÉ‡∏´‡∏°‡πà
```

---

## üìö ‡∏™‡∏£‡∏∏‡∏õ

‡∏£‡∏∞‡∏ö‡∏ö Arbi Trading ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏´‡∏≤ **Correlation ‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô (Multi-Layer)** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô:

### ‚úÖ ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô:
1. **Flexible**: ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ
2. **Accurate**: ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏£‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô
3. **Reliable**: ‡∏°‡∏µ Fallback ‡πÄ‡∏™‡∏°‡∏≠
4. **Smart**: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

### üéØ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:
1. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Historical Data
2. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏à‡∏∞‡πÉ‡∏ä‡πâ Tick Data
3. ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏à‡∏∞ Estimate ‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á
4. ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ Default

### üîÑ ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Recovery:
1. ‡∏´‡∏≤ Correlation pairs ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ Correlation ‡∏™‡∏π‡∏á (>= 0.70)
3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Volume ‡πÅ‡∏•‡∏∞ Direction
4. Execute Recovery order
5. Monitor ‡∏à‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏≥‡∏Å‡∏≥‡πÑ‡∏£

---

**‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:**
- [SYSTEM_FLOWCHART.md](./SYSTEM_FLOWCHART.md) - Flowchart ‡∏£‡∏∞‡∏ö‡∏ö
- [SYSTEM_OVERVIEW_SIMPLE.md](./SYSTEM_OVERVIEW_SIMPLE.md) - ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢
